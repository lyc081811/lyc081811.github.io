(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ae472628"],{"4d88":function(e,t,a){},"9f01":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content SMSManage"},[e._m(0),a("div",{staticClass:"peopleData"},[a("div",{staticClass:"propleSearch"},[a("el-input",{staticClass:"arcRadius",staticStyle:{width:"150px"},attrs:{placeholder:"请搜索"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.getData(!0)}},model:{value:e.params.Condition,callback:function(t){e.$set(e.params,"Condition",t)},expression:"params.Condition"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})]),a("el-select",{attrs:{placeholder:"发送状态",clearable:""},model:{value:e.params.SendStatus,callback:function(t){e.$set(e.params,"SendStatus",t)},expression:"params.SendStatus"}},e._l(e.sendStatus,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}),1),a("el-select",{attrs:{placeholder:"短信类型",clearable:""},model:{value:e.params.SmsType,callback:function(t){e.$set(e.params,"SmsType",t)},expression:"params.SmsType"}},e._l(e.SMSTypes,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}),1),a("el-select",{attrs:{placeholder:"时间类型",clearable:""},model:{value:e.params.SmsTimeType,callback:function(t){e.$set(e.params,"SmsTimeType",t)},expression:"params.SmsTimeType"}},e._l(e.SMSTimeTypes,function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}),1),a("div",{staticStyle:{display:"inline-block",margin:"0 16px"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},model:{value:e.params.timeRange,callback:function(t){e.$set(e.params,"timeRange",t)},expression:"params.timeRange"}})],1),a("el-button",{on:{click:function(t){e.getData(!0)}}},[e._v("查询")]),a("div",{staticClass:"right"},[a("el-button",{attrs:{type:"primary"},on:{click:e.sendSMS}},[e._v("批量发送")])],1)],1)]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData},on:{"selection-change":e.handleSelectionChange,"row-click":e.clickRow2}},[a("el-table-column",{attrs:{type:"selection",width:"50"}}),a("el-table-column",{attrs:{prop:"customerName",label:"客户姓名"}}),a("el-table-column",{attrs:{prop:"cardNum",label:"卡号"}}),a("el-table-column",{attrs:{prop:"tele",label:"手机号"}}),a("el-table-column",{attrs:{prop:"smsType",label:"短信类型"}}),a("el-table-column",{attrs:{prop:"sendContent",label:"短信内容"}}),a("el-table-column",{attrs:{prop:"sendTime",label:"发送时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDate")(t.row.sendTime,"YYYY-MM-DD"))+"\n        ")]}}])}),a("el-table-column",{attrs:{prop:"sendStatus",label:"发送状态"}}),a("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){e.sendSMS(t.row)}}},[e._v("发送")])]}}])})],1),a("div",{staticClass:"fixBottom"},[a("el-button",{attrs:{type:"text"},on:{click:function(t){e.toggleSelection()}}},[e._v("反选")]),a("span",{staticClass:"subitem"},[e._v("\n        合计：\n        "),a("span",{staticClass:"labelColor ftArial"},[e._v(e._s(e.tableData.length||0))])]),a("span",{staticClass:"subitem"},[e._v("\n        选中：\n        "),a("span",{staticClass:"labelColor ftArial"},[e._v(e._s(e.multipleTable.length||0))])]),a("div",{staticClass:"right"},[a("el-pagination",{attrs:{layout:"total,sizes, prev, pager, next",total:e.total,"page-sizes":[10,20,50,100],"current-page":e.searchParams.PageIndex},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)],1)],1)},n=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"topTitle"},[a("span",[e._v("短信管理")])])}],i=(a("ac6a"),a("c1df")),l=a.n(i),r={name:"SMSManage",data:function(){return{searchParams:{Condition:"",SendStatus:"",SmsType:"",SmsTimeType:"",BeginTime:"",EndTime:"",PageIndex:1,PageSize:10},params:{Condition:"",SendStatus:"",SmsType:"",SmsTimeType:"",BeginTime:"",EndTime:"",timeRange:[l()().add(-1,"weeks").format(),l()().format()]},loading:!1,total:0,timeRange:[l()().add(-1,"weeks").format(),l()().format()],sendStatus:[],SMSTypes:[],SMSTimeTypes:[],tableData:[],multipleTable:[],pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]}}},created:function(){this.getData(!0),this.getTypeEnum()},methods:{toggleSelection:function(){var e=this;this.tableData?this.tableData.forEach(function(t){e.$refs.multipleTable.toggleRowSelection(t)}):this.$refs.multipleTable.clearSelection()},getTypeEnum:function(){var e=this;this.$getType("SendStatus").then(function(t){200===t.status&&1===t.data.status&&(e.sendStatus=t.data.entity)}),this.$getType("SMSTimeType").then(function(t){200===t.status&&1===t.data.status&&(e.SMSTimeTypes=t.data.entity)}),this.$axios.get(this.$api.ReturnSMSType).then(function(t){t.data.entity&&1===t.data.status?e.SMSTypes=t.data.entity:e.$message.error(t.data.message)}).catch(function(t){e.$message.error(t.data.message)})},getData:function(e){var t=this;this.loading=!0,e?(this.params.timeRange&&2===this.params.timeRange.length?(this.searchParams.BeginTime=l()(this.params.timeRange[0]).format("YYYY-MM-DD"),this.searchParams.EndTime=l()(this.params.timeRange[1]).format("YYYY-MM-DD")):(this.searchParams.BeginTime="",this.searchParams.EndTime=""),this.searchParams.Condition=this.params.Condition,this.searchParams.SendStatus=this.params.SendStatus,this.searchParams.SmsType=this.params.SmsType,this.searchParams.SmsTimeType=this.params.SmsTimeType,this.searchParams.PageIndex=1,this.timeRange=this.params.timeRange):(this.params.Condition=this.searchParams.Condition,this.params.SendStatus=this.searchParams.SendStatus,this.params.SmsType=this.searchParams.SmsType,this.params.SmsTimeType=this.searchParams.SmsTimeType,this.params.timeRange=this.timeRange),this.$axios.post(this.$api.SMSSendQuery,this.searchParams).then(function(e){1===e.data.status&&e.data.entity?(t.tableData=e.data.entity.bgSMSMessages,t.total=e.data.entity.dataNum):t.$message.error(e.data.message),t.loading=!1}).catch(function(e){t.loading=!1,t.$message.error(e.data.message)})},sendSMS:function(e){var t=this,a={OperatorCode:"001",Codes:[]};if(e.innerCode&&a.Codes.push(e.innerCode),0!==this.multipleTable.length||e.innerCode){this.multipleTable.forEach(function(e){a.Codes.push(e.innerCode)});var s=this.$message({message:"短信发送中...",duration:0});this.$axios.post(this.$api.SendSmsModBySMSQuery,a).then(function(e){if(1===e.data.status){t.getData();var a=e.data.entity.successCount,s=e.data.entity.errorCount,n=t.$createElement;t.$notify({title:"短信发送完成！",message:n("i",{style:"color: #606266"},"成功".concat(a,"条，失败").concat(s,"条，合计").concat(s+a,"条。"))})}else t.$message.error(e.data.message)}).catch(function(e){t.$message.error(e.data.message),s.close()})}else this.$message.error("请选择后点击批量发送")},handleCurrentChange:function(e){this.searchParams.pageIndex=e,this.getData()},handleSizeChange:function(e){this.searchParams1.PageSize=e,this.searchParams.PageIndex=1,this.getData()},handleSelectionChange:function(e){this.multipleTable=e},clickRow2:function(e,t){"操作"!==t.label&&this.$refs.multipleTable.toggleRowSelection(e)}}},o=r,c=(a("beea"),a("2877")),m=Object(c["a"])(o,s,n,!1,null,"32a99926",null);m.options.__file="SMSManage.vue";t["default"]=m.exports},beea:function(e,t,a){"use strict";var s=a("4d88"),n=a.n(s);n.a}}]);